# i18n Standards

## Philosophy

**No hardcoded user-facing text.** All strings shown to users must use Rails i18n.

## Key Conventions

### Lazy Lookup in Views

Use the shorthand `.key` notation in views - Rails automatically infers the full path:

```erb
<%# In app/views/sessions/new.html.erb %>
<%= t(".heading") %>  <%# Looks up en.sessions.new.heading %>
<%= t(".email_label") %>
```

### Lazy Lookup in Mailers

Same pattern works in mailers:

```ruby
# In app/mailers/user_mailer.rb, method magic_link
mail(to: user.email, subject: t(".subject"))  # en.user_mailer.magic_link.subject
```

### Controllers Use Full Paths

Controllers should use explicit paths for clarity:

```ruby
redirect_to path, notice: t("controllers.sessions.create.notice")
redirect_to path, alert: t("controllers.application.authenticate_user")
```

### Interpolation

Use `%{variable}` for dynamic values:

```yaml
# config/locales/en/controllers.yml
en:
  controllers:
    sessions:
      verify:
        notice: "Welcome back, %{name}!"
```

```ruby
t("controllers.sessions.verify.notice", name: user.name)
```

## File Structure

```
config/locales/
├── en.yml                      # Common terms (app_name, common.*)
└── en/
    ├── controllers.yml         # Flash messages and controller strings
    ├── mailers.yml            # Email subjects and content
    └── views/
        ├── sessions.yml       # User login views
        ├── home.yml           # Dashboard
        ├── chats.yml          # Chat views
        ├── models.yml         # AI models views
        ├── messages.yml       # Message form
        ├── shared.yml         # Sidebar, flash, shared partials
        └── admins/
            └── sessions.yml   # Admin login views
```

## What to Translate

| Always Translate | Don't Translate |
|-----------------|-----------------|
| Headings and titles | HTML attributes (class, id, data-*) |
| Button labels | Code paths and URLs |
| Form labels and placeholders | Technical identifiers |
| Error and success messages | Database values |
| Help text and descriptions | CSS values |
| Navigation labels | File names in code blocks |

## Quality Checks

Run before committing:

```bash
bundle exec i18n-tasks health    # Full health check (in CI)
bundle exec i18n-tasks missing   # Find missing translations
bundle exec i18n-tasks unused    # Find unused translations
```

## Adding New Translations

1. **Add the key to the appropriate locale file** following the file structure
2. **Use lazy lookup** (`.key`) in views and mailers where possible
3. **Use full paths** in controllers for clarity
4. **Run `i18n-tasks health`** to verify no missing or unused keys

## Examples

### View with Lazy Lookup

```erb
<%# app/views/users/show.html.erb %>
<h1><%= t(".heading") %></h1>
<p><%= t(".description", name: @user.name) %></p>
```

```yaml
# config/locales/en/views/users.yml
en:
  users:
    show:
      heading: "User Profile"
      description: "Welcome, %{name}!"
```

### Controller Flash Message

```ruby
# app/controllers/users_controller.rb
def create
  @user = User.create!(user_params)
  redirect_to @user, notice: t("controllers.users.create.notice")
end
```

```yaml
# config/locales/en/controllers.yml
en:
  controllers:
    users:
      create:
        notice: "User created successfully"
```

### Form Labels

```erb
<%= form.label :email, t(".email_label") %>
<%= form.text_field :email, placeholder: t(".email_placeholder") %>
```

## Common Patterns

### Pluralization

```yaml
en:
  messages:
    count:
      one: "1 message"
      other: "%{count} messages"
```

```ruby
t("messages.count", count: @messages.size)
```

### Defaults

When a key might not exist, provide a default:

```erb
<%= t(".title", default: "Default Title") %>
```
