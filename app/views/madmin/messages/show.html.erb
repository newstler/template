<%= content_for :title, resource.display_name(@record) %>

<header class="header">
  <h1>
    <%= link_to resource.friendly_name.pluralize, resource.index_path %>
    /
    <%= resource.display_name(@record) %>
  </h1>

  <div class="actions">
    <% resource.member_actions.each do |action| %>
      <%= instance_exec(@record, &action) %>
    <% end %>
    <%= link_to "Edit", resource.edit_path(@record), class: "btn btn-secondary" %>
    <%= button_to "Delete", resource.show_path(@record), method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "btn btn-danger" %>
  </div>
</header>

<div class="bg-white rounded-lg shadow mb-6 p-4">
  <div class="grid grid-cols-2 gap-4 text-sm">
    <div>
      <span class="text-gray-500">Chat:</span>
      <span class="font-medium"><%= link_to @record.chat_id, madmin_chat_path(@record.chat), class: "text-blue-600 hover:underline" %></span>
    </div>
    <div>
      <span class="text-gray-500">Role:</span>
      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= @record.role == 'user' ? 'bg-blue-100 text-blue-800' : @record.role == 'assistant' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800' %>">
        <%= @record.role %>
      </span>
    </div>
    <div>
      <span class="text-gray-500">Created:</span>
      <span class="font-medium"><%= @record.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
    </div>
    <div>
      <span class="text-gray-500">Tokens:</span>
      <span class="font-medium">
        <% if @record.input_tokens.present? || @record.output_tokens.present? %>
          In: <%= @record.input_tokens || 0 %> / Out: <%= @record.output_tokens || 0 %>
        <% else %>
          N/A
        <% end %>
      </span>
    </div>
  </div>
</div>

<div class="bg-white rounded-lg shadow">
  <div class="p-4 border-b border-gray-200">
    <h2 class="text-lg font-semibold text-gray-900">Message Content</h2>
  </div>
  <div class="p-6">
    <% if @record.role == 'user' %>
      <div class="flex justify-end">
        <div class="max-w-[85%] bg-blue-600 text-white rounded-2xl rounded-br-md px-4 py-3">
          <div class="whitespace-pre-wrap"><%= @record.content %></div>
        </div>
      </div>
    <% elsif @record.role == 'system' %>
      <div class="bg-gray-100 text-gray-600 rounded-lg px-4 py-3">
        <span class="font-medium">System Prompt:</span>
        <div class="mt-2 whitespace-pre-wrap"><%= @record.content %></div>
      </div>
    <% else %>
      <div class="prose max-w-none text-gray-700"><%= markdown(@record.content) %></div>
    <% end %>
  </div>
</div>

<% if @record.tool_calls.any? %>
  <div class="bg-white rounded-lg shadow mt-6">
    <div class="p-4 border-b border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900">Tool Calls</h2>
    </div>
    <div class="p-4">
      <% @record.tool_calls.each do |tool_call| %>
        <div class="bg-gray-50 rounded-lg p-4 mb-4 last:mb-0">
          <div class="font-medium text-gray-900 mb-2"><%= tool_call.name %></div>
          <pre class="text-sm bg-gray-900 text-gray-100 rounded p-3 overflow-x-auto"><%= JSON.pretty_generate(tool_call.arguments) rescue tool_call.arguments %></pre>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
