<%= content_for :title, resource.friendly_name.pluralize %>

<header class="header">
  <h1><%= resource.friendly_name.pluralize %></h1>

  <div class="actions">
    <form class="search">
      <%= hidden_field_tag :page, params[:page], value: 1 %>
      <%= search_field_tag :q, params[:q], placeholder: "Search #{resource.friendly_name.pluralize.downcase}...", class: "form-input" %>
    </form>

    <% if params[:q].present? %>
      <%= link_to resource.index_path, class: "btn btn-secondary" do %>
        Clear
      <% end %>
    <% end %>

    <% if resource.actions.include?(:new) %>
      <%= link_to resource.new_path, class: "btn btn-primary" do %>
        New <%= resource.friendly_name %>
      <% end %>
    <% end %>
  </div>
</header>

<% if resource.scopes.any? %>
  <nav class="scopes">
    <%= link_to "All", resource.index_path, class: class_names("btn btn-secondary", {"active" => params[:scope].blank?}) %>
    <% resource.scopes.each do |scope| %>
      <%= link_to scope.to_s.humanize, resource.index_path(scope: scope, q: params[:q], sort: params[:sort], direction: params[:direction]), class: class_names("btn btn-secondary", {"active" => params[:scope] == scope.to_s}) %>
    <% end %>
  </nav>
<% end %>

<%
  visible_attributes = resource.attributes.values.select { |a| a.field.present? && a.field.visible?(action_name) && a.name.to_s != "id" }
  first_linkable = visible_attributes.first
%>

<div class="table-scroll">
  <table>
    <thead>
      <tr>
        <% visible_attributes.each do |attribute| %>
          <th><%= sortable attribute.name, attribute.name.to_s.titleize %></th>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% @records.each do |record| %>
        <tr>
          <% visible_attributes.each_with_index do |attribute, index| %>
            <td>
              <% if index == 0 %>
                <%= link_to resource.show_path(record), class: "font-medium hover:underline" do %>
                  <%= render partial: attribute.field.to_partial_path("index"), locals: { field: attribute.field, record: record, resource: resource } %>
                <% end %>
              <% else %>
                <%= render partial: attribute.field.to_partial_path("index"), locals: { field: attribute.field, record: record, resource: resource } %>
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="pagination">
  <% if @pagy.respond_to?(:series_nav) %>
    <%== @pagy.series_nav if @pagy.last > 1 %>
    <%== @pagy.info_tag %>
  <% else %>
    <%== pagy_nav @pagy if @pagy.last > 1 %>
    <%== pagy_info @pagy %>
  <% end %>
</div>
